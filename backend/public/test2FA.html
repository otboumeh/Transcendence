<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Probar Verificación 2FA</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; background-color: #f8f9fa; color: #212529; }
    h1 { color: #343a40; text-align: center; }
    section { background: #fff; border: 1px solid #dee2e6; border-radius: 0.5rem; padding: 2rem; }
    label { display: block; margin-top: 1rem; font-weight: 500; }
    input { margin-top: 0.5rem; padding: 0.75rem; width: 100%; border: 1px solid #ced4da; border-radius: 0.25rem; box-sizing: border-box; }
    button { cursor: pointer; background-color: #007bff; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.25rem; font-size: 1rem; width: 100%; margin-top: 1.5rem; }
    button:hover { background-color: #0056b3; }
    pre { background: #e9ecef; padding: 1rem; border-radius: 0.25rem; white-space: pre-wrap; word-wrap: break-word; max-height: 400px; overflow-y: auto; margin-top: 1.5rem; }
  </style>
</head>
<body>

  <section>
    <h1>Verificación de Dos Factores (2FA)</h1>
    <form id="verify-form">
      <label for="challenge-id">Challenge ID:</label>
      <input type="number" id="challenge-id" placeholder="Pega el ID recibido en el paso de login" required />

      <label for="verification-code">Código de Verificación:</label>
      <input type="text" id="verification-code" placeholder="Pega el código de 6 dígitos del correo" required maxlength="6" pattern="\d{6}" />
      
      <button type="submit">Verificar</button>
    </form>
    
    <h3>Respuesta del Servidor:</h3>
    <pre id="response-box">La respuesta aparecerá aquí...</pre>
  </section>

  <script>
    const verifyForm = document.getElementById('verify-form');
    const challengeIdInput = document.getElementById('challenge-id');
    const verificationCodeInput = document.getElementById('verification-code');
    const responseBox = document.getElementById('response-box');

    verifyForm.addEventListener('submit', async (event) => {
      event.preventDefault(); // Evita que el formulario se envíe de la forma tradicional

      const challengeId = challengeIdInput.value;
      const code = verificationCodeInput.value;

      if (!challengeId || !code) {
        alert('Por favor, rellena ambos campos.');
        return;
      }

      // Preparamos los datos para enviar en formato JSON
      const data = {
        id: parseInt(challengeId, 10), // El backend espera 'id'
        code: code
      };

      try {
        // Hacemos la petición POST al endpoint de verificación
        const response = await fetch('/api/auth/verify-2fa.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        // Obtenemos la respuesta JSON del servidor
        const result = await response.json();

        // Mostramos la respuesta formateada en la caja <pre>
        responseBox.textContent = JSON.stringify(result, null, 2);

      } catch (error) {
        // Mostramos cualquier error de red o de parseo
        responseBox.textContent = `Error: ${error.message}`;
      }
    });
  </script>

</body>
</html>